<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.mapper.BoardMapper">
<select id="list" resultType="BoardVO"> select * from tb1_board where bno > 0 </select>
<insert id="insert"> insert into tb1_board (title, content, writer) values (#{title}, #{content}, #{writer}) </insert>
<select id="read" resultType="BoardVO"> select * from tb1_board where bno = #{bno} </select>
<delete id="delete"> delete from tb1_board where bno = #{bno} </delete>
<update id="update"> update tb1_board set title = #{title}, content = #{content}, writer = #{writer}, updateDate = CURRENT_TIMESTAMP where bno = #{bno} </update>

<!-- 지금은 쓸모없음 -->
<select id="selectBno" resultType="BoardVO"> select * from tb1_board where title = #{title} and content = #{content} and writer = #{writer} </select>

<!-- 페이징 -->
  	<select id="paginglist" resultType="BoardVO">
	select * from tb1_board;
	</select>
	
	<select id="listSum" resultType="int">
		select count(*) from tb1_board;
	</select>
	
	<!-- <select id="getListWithPaging" resultType="BoardVO" parameterType="java.util.HashMap">
		select * from tb1_board order by bno desc limit #{pstartno} , #{onepageList}
	</select> -->

<!-- 검색부분 -->
	<!-- 검색 조건 탐색
		 T : 제목
		 C : 내용
		 TC: 제목과내용
		 W : 작성자
		 trim : 접두어(prefix), 접미어(suffix)를 붙이거나 지워준다. (<if> 태그를 보완완)
		 prefix 속성 - <trim>태그 내부 실행될 쿼리문 앞에 설정값을 삽입
		 suffix 속성 - <trim>태그 내부 실행될 쿼리문 뒤에 설정값을 삽입
		 prefixOverrids 속성 - <trim>태그 내부 실행될 쿼리문 가장 앞의 단어가 설정해둔 문자와 동일할 경우 문자를 지움
		 suffixOverrids 속성 - <trim> 태그 내부 실행될 쿼리문 가장 뒤의 단어가 설정해둔 문자와 동일한 경우 문자를 지움
	-->
	<!-- if구문을 통해 조건에 맞는 게시물을 출력해줍니다. -->
	<select id="getListWithPaging" resultType="BoardVO">
		SELECT * FROM
			tb1_board WHERE 
			<if test="keyword != null">
				<include refid="condition"></include>
			</if>
			<!-- order by bno desc limit #{pstartno} , #{onepageList} -->
			ORDER BY bno asc limit 10
	</select>

	<sql id = "condition">
		<trim prefix="(" suffix=") AND" prefixOverrides="OR">
			<foreach collection="typeArr" item="type">
				<trim prefix="OR">
					<choose>
					    <when test="type == 'T'.toString()">
					        title like '%'||#{keyword}||'%' 
					    </when>
					    <when test="type == 'C'.toString()">
					        content like '%'||#{keyword}||'%' 
					    </when>
					    <when test="type == 'W'.toString()">
					        writer like '%'||#{keyword}||'%' 
					    </when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>
	
	<!-- 검색한 게시물의 총갯수 -->
	<select id="ListCount" resultType="BoardVO">
		SELECT count(*) FROM tb1_board WHERE 
			<if test="keyword != null">
				<include refid="condition"></include>
			</if>
	</select>
</mapper>